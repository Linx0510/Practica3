<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <link rel="stylesheet" href="/style.css">
    <title>Админ панель</title>
</head>
<body>
    <div class="container">
        <h2>Админ панель</h2>
        <p>Добро пожаловать в панель администратора!</p>
        
        <div id="adminContent">
            <h3>Управление пользователями</h3>
            <div id="usersList">Загрузка пользователей...</div>
        </div>
        
        <br>
        <a href="/profile">Назад в профиль</a><br>
        <a href="/logout">Выйти</a>
    </div>

    <script>
        async function checkAuthAndLoadUsers() {
            try {
                const authCheck = await fetch('/api/user-info');
                if (!authCheck.ok) {
                    window.location.href = '/login';
                    return;
                }
                
                const user = await authCheck.json();
                if (user.role !== 'Админ') {
                    alert('Доступ запрещен! Только для администраторов.');
                    window.location.href = '/profile';
                    return;
                }
                
                await loadUsers();
            } catch (error) {
                console.error('Ошибка:', error);
                window.location.href = '/login';
            }
        }
        
        async function loadUsers() {
            try {
                const response = await fetch('/api/users');
                if (response.ok) {
                    const users = await response.json();
                    
                    const usersList = document.getElementById('usersList');
                    usersList.innerHTML = `
                        <table style="width: 100%; border-collapse: collapse;">
                            <thead>
                                <tr>
                                    <th style="border: 1px solid #ddd; padding: 8px;">ID</th>
                                    <th style="border: 1px solid #ddd; padding: 8px;">Логин</th>
                                    <th style="border: 1px solid #ddd; padding: 8px;">Роль</th>
                                </tr>
                            </thead>
                            <tbody>
                                ${users.map(user => `
                                    <tr>
                                        <td style="border: 1px solid #ddd; padding: 8px;">${user.id}</td>
                                        <td style="border: 1px solid #ddd; padding: 8px;">${user.login}</td>
                                        <td style="border: 1px solid #ddd; padding: 8px;">${user.role}</td>
                                    </tr>
                                `).join('')}
                            </tbody>
                        </table>
                    `;
                }
            } catch (error) {
                console.error('Ошибка загрузки пользователей:', error);
            }
        }
        
        document.addEventListener('DOMContentLoaded', checkAuthAndLoadUsers);
    </script>
</body>
</html>